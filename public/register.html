<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Register</title>
	<script src="https://code.jquery.com/jquery.js"></script>
	<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css"> -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans|Rammetto+One" rel="stylesheet">
	<script src="https://use.fontawesome.com/227ddb778d.js"></script>
	<script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
	<link href="css/mat-css/gallery-materialize.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<style type="text/css">
	#regHeader {
		top: 0px;
	}

	.iconBox {
		height: 210px;
		padding-top: 33px;
		margin-top: 50px;
		border-style: solid;
		/* background-color: white; */
		padding-top: 26px !important;
	}

	.row {
		height: 77px;
	}

	.btn {
		margin-top: 10px;
	}

	.resize {
		height: 100%; 
		position:absolute!important; 
		width: 100%;
	}

	.aniIcon:hover {
    transform: translateY(-10px);
	}

	select{
		position: relative;
		z-index: 100;
	}

	#dropdown1, #dropdown2, #dropdown3{
		position: absolute;
		z-index: 9;
	}

	nav{
		position: relative;
		z-index: 1;
	}

	.card{
		cursor: pointer;
		margin: 40px;
	}

	#book-form-section{
		margin-left: -20px;
	}
/* 
	p {
		font-family: 'Open Sans', sans-serif;
	} */
</style>
<body>

<!-- Navbar and Header -->
<nav class="nav-extended">
        <div class="nav-background">
            <div class="pattern active" style="background-image: url('images/introbooks.jpeg');"></div>
        </div>
        <div class="nav-wrapper container">
            <a href="landing.html"> <img src="images/itslit1.png" id="hold-logo" class="lit-props"></a>


            <!-- <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
            <ul class="right hide-on-med-and-down">

                <li><a class='dropdown-button' href='#' data-activates='feature-dropdown' data-belowOrigin="true" data-constrainWidth="false">User Account<i class="material-icons right">arrow_drop_down</i></a></li>
            </ul> -->
       
            <div class="nav-header center">
                <h3 id="dynamic-header">First, We'll Need the Basics:</h3>

            </div>
        </div>
    </nav>

			<ul class="side-nav" id="nav-mobile">
				<li class="active"><a href="index.html"><i class="material-icons">flare</i>Gallery</a></li>
				<li><a href="index-dark.html"><i class="material-icons">brightness_3</i>Dark Theme</a></li>
				<li><a href="blog.html"><i class="material-icons">edit</i>Blog</a></li>
				<li><a href="docs.html"><i class="material-icons">school</i>Docs</a></li>
				<li><a href="full-header.html"><i class="material-icons">fullscreen</i>Fullscreen Header</a></li>
				<li><a href="horizontal.html"><i class="material-icons">swap_horiz</i>Horizontal Style</a></li>
				<li><a href="no-image.html"><i class="material-icons">texture</i>No Image Expand</a></li>
			</ul>
		

  <div class="white resize" id="formOne" href="#one!"  style="z-index: 4">
		<div class="row">
			<!-- <h5 class="center-align">First, We'll Need the Basics: </h5> -->
			<form class="offset-s3 col s6">
				<div class="row">
						<div class="input-field col s6">
						<input id="name" type="text" class="validate">
						<label for="name">Name</label>
					</div>
				</div>
				<div class="row">
					<div class="input-field col s6">
						<input id="city" type="text" class="validate">
						<label for="city">City</label>
					</div>
					<div class="input-field col s6">
						<input id="state" type="text" class="validate">
						<label for="state">State</label>
					</div>
				</div>
				<div class="row">
					<div class="input-field col s6">
						<input id="password" type="password" class="validate">
						<label for="password">Password</label>
					</div>
					<div class="input-field col s6">
						<input id="email" type="email" class="validate">
						<label for="email">Email</label>
					</div>
				</div>
				<div class="row">
					<div class="offset-s9 col s3">
						<a class="btn waves-effect orange submitBtn" id="userSubmit">Submit</a>
					</div>
				</div>
			</form>
		</div>
    </div>

     <div class="white resize" id="formTwo" href="#two!" style="z-index: 3">
		<div class="row">
			<form class="offset-s2 col s7">
				<div class="row">
					<div class="input-field col s4">
						<input id="title1" type="text" class="validate">
						<label for="title1">Insert Title</label>
					</div>
					<div class="input-field col s4">
						<input id="author1" type="text" class="validate">
						<label for="author1">Insert Author</label>
					</div>
					<div class=" input-field col s4">
						<select id="dropdown1">
							<option value="" disabled selected>Where's Your Book Best Fit?</option>
							<option value="horror">Horror</option>
							<option value="mystery">Mystery</option>
							<option value="action">Action/Adventure</option>
							<option value="fantasy">Fantasy</option>
							<option value="classic">Classic</option>
							<option value="YA">Young Adult</option>
						</select>
						<label>Genre</label>
					</div>
				</div>
				<div class="row">
					<div class="input-field col s4">
						<input id="title2" type="text" class="validate">
						<label for="title2">Insert Title</label>
					</div>
					<div class="input-field col s4">
						<input id="author2" type="text" class="validate">
						<label for="author2">Insert Author</label>
					</div>
					<div class="input-field col s4">
						<select id="dropdown2">
							<option value="" disabled selected>Where's Your Book Best Fit?</option>
							<option value="horror">Horror</option>
							<option value="mystery">Mystery</option>
							<option value="action">Action/Adventure</option>
							<option value="fantasy">Fantasy</option>
							<option value="classic">Classic</option>
							<option value="YA">Young Adult</option>
						</select>
						<label>Genre</label>
					</div>
				</div>
				<div class="row">
					<div class="input-field col s4">
						<input id="title3" type="text" class="validate">
						<label for="title3">Insert Title</label>
					</div>
					<div class="input-field col s4">
						<input id="author3" type="text" class="validate">
						<label for="author3">Insert Author</label>
					</div>
					<div class="input-field col s4">
						<select id="dropdown3">
							<option value="" disabled selected>Where's Your Book Best Fit?</option>
							<option value="horror">Horror</option>
							<option value="mystery">Mystery</option>
							<option value="action">Action/Adventure</option>
							<option value="fantasy">Fantasy</option>
							<option value="classic">Classic</option>
							<option value="YA">Young Adult</option>
						</select>
						<label>Genre</label>
					</div>
				</div>
				<div class="row">
					<div class="offset-s9 col s3">
						<a class="btn waves-effect orange submitBtn" id="bookSubmit">Submit</a>
					</div>
				</div>
			</form>
		</div>
    </div>
     <div class="white resize" href="#three!"  style="z-index: 2">
		<div class="row center-align">
			<div class="offset-s1 col s3 iconBox card">
				<i class="fa fa-user-secret fa-4x aniIcon" aria-hidden="true"></i>
				<h5 class="genre">Mystery</h5>
				<p>Can't resist a good "Whodunit"</p>
			</div>
			<div class="col s3 iconBox card">
				<i class="fa fa-eye fa-4x aniIcon" aria-hidden="true"></i>
				<h5 class="genre">Horror</h5>
				<p>Has a secret love for what goes "bump" in the night</p>
			</div>
			<div class="col s3 iconBox card">
				<i class="fa fa-users fa-4x aniIcon" aria-hidden="true"></i>
				<h5 class="genre">Young Adult</h5>
				<p>For those young and young at heart</p>
			</div>
		</div>
		<div class="row"></div>
		<div class="row center-align">
			<div class="offset-s1 col s3 iconBox card">
				<i class="fa fa-magic fa-4x aniIcon" aria-hidden="true"></i>
				<h5 class="genre">Fantasy</h5>
				<p>Never outgrew those childhood fairy-tales</p>
			</div>
			<div class="col s3 iconBox card">
				<i class="fa fa-compass fa-4x aniIcon" aria-hidden="true"></i>
				<h5 class="genre">Action/Adventure</h5>
				<p>Your heart longs for the Wild Blue Yonder</p>
			</div>
			<div class="col s3 iconBox card">
				<i class="fa fa-university fa-4x aniIcon" aria-hidden="true"></i>
				<h5 class="genre">Classic</h5>
				<p>Loves to party Old-School</p>
			</div>
		</div>
		<div class="row">
			<div class="offset-s9 col s3">
				<a class="btn waves-effect orange submitBtn" id="seeMatches">Find My Matches!</a>
			</div>
		</div>
    </div>
</div>

<script type="text/javascript">
	$(document).ready(function () {
 	  var userId = moment().format("x").toString();
	  var formOne = $("#formOne");
	  var visible = true;
	  var emailInput;
	  var passwordInput;


		var formTwo = $("#formTwo");
		formTwo.hide();
	
		function formProgress() {
			if (visible === false) {
				formTwo.hide();
				return;
			}
			if (visible === true) {
				formTwo.show();
				formOne.hide();
				visible = false;
				return;
			}
		}

		$('select').material_select();

		$(".submitBtn").on("click", function() {		
			formProgress();
		});


	$(".iconBox").on("click", function () {
		
		$(this).addClass("red");
		var changedGenre = $(this).find("h5").text().toLowerCase();

		//use conditional if the tile clicked on is action/adventure or Young Adult
		//so that it matches the column name in the database
		if (changedGenre == "action/adventure"){
			changedGenre = "action";
		}
		if (changedGenre == "young adult"){
			changedGenre = "YA";
		}

		$.ajax(`/api/users/${userId}/${changedGenre}`, {
			type: "PUT",
			data: {}
		}).then(function(data) {
			console.log("data nect line: ")
			console.log(data)
			console.log("Genre Changed!")
		
			
		
	});

	});	

	$("#updateGen").on("click", function () {

		var newProfile = {
		name: $("#name").val().trim(),
		city: $("#city").val().trim(),	
		state: $("#state").val().trim(),
		password: $("#password").val().trim(),
		email: $("#email").val().trim(),
		UserId: userId
		}

			$.ajax("/api/users", {
			type: "POST",
			data: newProfile,
		}).then(function(data) {
			console.log("Hi")
		})
	})




	$("#seeMatches").on("click", function () {

	
		console.log(emailInput);
		console.log(passwordInput);
		

		loginUser(emailInput, passwordInput);
		emailInput.val("");
		passwordInput.val("");

  })

// loginUser does a post to our "api/login" route and if successful, redirects us the the members page
function loginUser(email, password) {
		$.post("/api/login", {
			email: email,
			password: password
		}).then(function(data) {
			window.location.replace(data);
			// If there's an error, log the error
		}).catch(function(err) {
			console.log(err);
		});
  }





	$("#userSubmit").on("click", function () {
		emailInput = $("#email").val().trim();
        passwordInput = $("#password").val().trim();

		$("#dynamic-header").text("What Books Can You Lend?");

		var newProfile = {
		name: $("#name").val().trim(),
		city: $("#city").val().trim(),	
		state: $("#state").val().trim(),
		password: $("#password").val().trim(),
		email: $("#email").val().trim(),
		UserId: userId
		}

		$.ajax("/api/users", {
				type: "POST",
				data: newProfile,
			}).then(function(data) {
				console.log("User Submitted")})
		})


		
	$("#bookSubmit").on("click", function () {
		$("#dynamic-header").text("Which Genres Do You Prefer?");
		$.ajax("/api/user_data", {
			type: "GET"
		}).then(function(data) {
		
		console.log("Hi")})
		var firstBook = {
			title: $("#title1").val().trim(),
			author: $("#author1").val().trim(),
			genre: $( "select#dropdown1 option:checked" ).val(),
			UserUserId: userId

		}

		var secondBook = {
			title: $("#title2").val().trim(),
			author: $("#author2").val().trim(),
			genre: $( "select#dropdown2 option:checked" ).val(),
			UserUserId: userId 
		}

		var thirdBook = {
			title: $("#title3").val().trim(),
			author: $("#author3").val().trim(),
			genre: $( "select#dropdown3 option:checked" ).val(),
			UserUserId: userId			
		}

		var apiPicLink;
		var apiDescription;
		var bookList = [];
		console.log("FIRST BOOK BELOW:")
		console.log(firstBook);
		console.log("second BOOK BELOW:")
		console.log(secondBook)
		console.log("third BOOK BELOW:")
		console.log(thirdBook)

		if (firstBook.title && firstBook.author){
		bookList.push(firstBook);
		console.log(bookList);
		}

		if (secondBook.title && secondBook.author){
		bookList.push(secondBook);
		console.log(bookList);
		}

		if (thirdBook.title && thirdBook.author){
			bookList.push(thirdBook);
			console.log(bookList); 
		}
	
		for (var i = 0; i < bookList.length; i++) {

			findBookApiInfo(bookList[i])
			
		}

		
	}); //close book submit

// we do this function so we don't have to keep going back to the googleBooksAPI each time we want to display a book cover
	function findBookApiInfo(bookObj){
	  console.log("TITLE");
	  console.log(bookObj.title);

	  // removing characters and spaces from the title and switch to lower case
	  var thisTitle = bookObj.title.split(" ");
	  thisTitle = thisTitle.join("");
	  if (thisTitle.indexOf(".") > -1){
	      thisTitle = thisTitle.split(".");
	      thisTitle = thisTitle.join("");
	  }
	  if (thisTitle.indexOf("'") > -1){
	      thisTitle = thisTitle.split("'");
	      thisTitle = thisTitle.join("");
	  }
	  thisTitle = thisTitle.toLowerCase();
	  console.log("thisTitle: " + thisTitle);


	  console.log("AUTHOR");
	  console.log(bookObj.author);
	  // removing characters and spaces from the author
	  var thisAuthor = bookObj.author.split(" ");
	  thisAuthor = thisAuthor.join("");
	  if (thisAuthor.indexOf(".") > -1){
	      thisAuthor = thisAuthor.split(".");
	      thisAuthor = thisAuthor.join("");
	  }
	  if (thisAuthor.indexOf("'") > -1){
	      thisAuthor = thisAuthor.split("'");
	      thisAuthor = thisAuthor.join("");
	  }
	  thisAuthor = thisAuthor.toLowerCase();
	  console.log("thisAuthor: " + thisAuthor);


	  // $("#book-cover").empty();
	  // $("#book-info").empty();

	  // APi ajax call to get the api bookId
	  $.ajax({
	     method: "GET",
	    url: "https://www.googleapis.com/books/v1/volumes?q=" + thisTitle + "+author=" + thisAuthor + "&filter=ebooks&key=AIzaSyCeH0ntzIH5qUGfnIumk6woxDQp7mRZDlA"
	   }).then(function(data){
	    console.log(data.items[0].id);
	    var gBookId = data.items[0].id;

	    // using the bookId do another API ajax call to get the cover and description
	    $.ajax({
        method: "GET",
        url: "https://www.googleapis.com/books/v1/volumes/" + gBookId
      }).then(function(data){
          console.log(data.volumeInfo);
           var bookInfo = data.volumeInfo;

        // take the large picture if it exists
        if (bookInfo.imageLinks.large){
        		apiPicLink = bookInfo.imageLinks.large
        		console.log("apiPicLink " + apiPicLink)
        		bookObj.picLink = apiPicLink;
        } 
        // otherwise take the thumbnail
        else {
        	apiPicLink = bookInfo.imageLinks.thumbnail
        	console.log("apiPicLink " + apiPicLink)
        	bookObj.picLink = apiPicLink;
        }

        apiDescription = bookInfo.description;
        console.log("apiDescription", apiDescription);
        bookObj.description = apiDescription;
        // bookDescrip.html(bookInfo.description);

        console.log("bookObj down here")
        console.log(bookObj)

        // now - post the book obj (which includes the link and description to our database)

        $.ajax("/api/books", {
					type: "POST",
					data: bookObj,
				}).then(function(data) {
					console.log("Book Submitted")
					console.log(data);
				});
	          
	          
	          });
      });

    }

	});
		



 

</script>

</body>
</html>