<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>It's Lit - Profile</title>
  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">  
  <!-- <link rel="stylesheet" href="css/styles.css" media="screen" title="no title"> -->
  <script src="https://code.jquery.com/jquery.js"></script>
   <!-- Compiled and minified JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
</head>

<body>

  <nav>
    <div class="nav-wrapper">
      <a href="#!" class="brand-logo">Logo</a>
      <ul class="right hide-on-med-and-down">
        <li><a href="main.html">Main</a></li>
        <li class="active"><a href="profile.html">Profile</a></li>
      </ul>
    </div>
  </nav>

  <div class="container">
    <div class="row">
      <h2>Books You Own:</h2>
    </div>
    <div class="row">
      <div class="col-m6 book-container">
        <!-- Title: <span ></span> Author: J.K. Rowling<a class="waves-effect waves-light btn button-borrow"></a> -->

      <div class="col-md-2 col-sm-2">
        
      </div>
    </div>
    
  </div>
  <script>
$(document).ready(function() {



      var bookId = $(".button-borrow").attr("data-bookId", 1);


$.ajax({
    method: "GET",
    url: "/api/books",
    data: {
      UserId: 1
    }
  }).then(function(data){
    console.log(data);
    for (let i = 0; i < data.length; i++) {
      var newTitle = $("<h5>");
      newTitle.text("Title: ");
      newTitle.append($("<span>").text(data[i].title));
      var newAuthor = $("<h5>");
      newAuthor.text("Author: ");
      newAuthor.append($("<span>").text(data[i].author));
      var newButton = $("<button>");
      newButton.addClass("waves-effect waves-light btn button-borrow");
      newButton.attr("data-bookid", data[i].id);
      newButton.attr("data-checkedout", data[i].checkedOut);
      
          if (data[i].checkedOut){
            newButton.text("Check In");
            newButton.removeClass("red");

          }
          else {
            newButton.text("Check Out");
            newButton.addClass("red");
          }
      
      $(".book-container").append(newTitle);
      $(".book-container").append(newAuthor);
      $(".book-container").append(newButton);
    }
  });



$(document).on("click", ".button-borrow", function(){
  console.log("THIS: " + $(this));
  var thisButton = $(this);
  var isCheckedOut = $(this).attr("data-checkedout");
  console.log("Up here: " + $(this).attr("data-checkedout"));

  
  var id = $(this).attr("data-bookid");
  console.log("ID: " + id);

  if (isCheckedOut === "true"){
    checkIn();
  }
  else {
    checkOut();
  }




  function checkIn(){
    $.ajax({
    type: "PUT",
    url: "/api/books/" + id + "/false",
    data: {
      id: id
      // checkedOut: false
    }
  }).then(function(){
    // isCheckedOut = false;
    thisButton.text("Check Out");
    thisButton.addClass("red");
    thisButton.attr("data-checkedOut", false);
    console.log("ID in AJAX" + id);
  });
  }

  function checkOut(){
    $.ajax({
    type: "PUT",
    url: "/api/books/" + id + "/true",
    data: {
      id: id
      // checkedOut: true
    }
  }).then(function(){
    // isCheckedOut = true;
    thisButton.text("Check In");
    thisButton.removeClass("red");
    thisButton.attr("data-checkedOut", true);
    
  });
  }
  


  
  
}); 


});

  </script>

  

</body>

</html>